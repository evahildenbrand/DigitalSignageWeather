<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Wetter</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <style>
      body {
        padding: 0;
        margin: 0;
        font-family: sans-serif;
        text-align: center;
        overflow: hidden;
      }
      .section {
        padding-top: 75px;
        font-size: 1em;
        text-align: center;
        width: 100%;
        height: 800px;
        color: #f0e8e8;
        text-shadow: 2px 2px 4px #000000;

        -webkit-transition: background 0.5s ease-in-out;
        transition: background 0.5s ease-in-out;
      }
      .night .section {   
        color: #e9e5d5;
      }
      .time-circle {
        position: relative;
        background: linear-gradient(to bottom, #be4405, #f6c60c);  /* Hintergrund-Farbverlauf für "Sonnenaufgang" */
        width: 500px;
        height: 500px;
        border-radius: 50%;
        border: 0.5px solid #f0e8e8;
        overflow: hidden;
        padding: 0px;
        margin: 0 auto;
        margin-bottom: 10px;
        box-shadow: 0 0 20px #000000;
        text-align: center;

        -webkit-transition: all 1.1s ease-in-out;
        transition: all 1.1s ease-in-out;
      }
      .night .time-circle {
        background: linear-gradient(to bottom, #111936, #285a7b);
        border-color: #e9e5d5;
      }
      .sun {
        background-color: #f2ef88;     
        width: 40%;
        height: 40%;
        margin-top: 10%;
        border-radius: 50%;
        position: relative;
        margin-left: 30%;
      }
      
      .night .sun {
        top: 70%;
        left: 20%;

        -webkit-transition: all 1.1s 0s ease;
        transition: all 1.1s 0s ease;
      }
      
      .moon {
        background-color: #d9d8d0;
        box-shadow: inset -10px 2px 0 0px #899098;
        width: 22.5%;
        height: 22.5%;
        border-radius: 100%;
        position: relative;
        left: 120%;
        margin-left: 0%;
        margin-top: -40%;
        top: -50%;
        overflow: hidden;

        -webkit-transition: all 1.1s 0s ease;
        transition: all 1.1s 0s ease;
      }
      .night .moon {
        left: 65%;
        top: -10%;
      }

      .moon div:nth-child(n) {
        position: relative;
        background: #b9b8b0;
        border-radius: 50%;
        box-shadow: inset 4px -2px 0 0px #535457;
      }
      .moon div:nth-child(1) {
        top: 25%;
        left: 12%;
        width: 27%;
        height: 27%;
      }
      .moon div:nth-child(2) {
        top: -11%;
        left: 60%;
        width: 16%;
        height: 16%;
      }
      .moon div:nth-child(3) {
        top: 25%;
        left: 44%;
        width: 16%;
        height: 16%;
      }
      
      .stars {
        opacity: 0;
        margin-left: 100px;
        top: 0;
        left: 0;
        -webkit-transition: all 0.8s 0s ease;
        transition: all 0.8s 0s ease;
        z-index: 1000;
      }
      .night .stars {
        opacity: 1;

        -webkit-transition: all 3s 0.4s ease;
        transition: all 3s 0.4s ease;
      }
      .stars div:nth-child(n) {
        position: absolute;
        background: radial-gradient(
          rgba(255, 255, 255, 1),
          rgba(255, 255, 255, 0)
        );
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(255, 255, 255, 1);
        overflow: hidden;
        width: 0.4%;
        height: 0.4%;

        margin-left: 20%;
        margin-top: -20%;

        -webkit-transition: all 1s 0s ease;
        transition: all 1s 0s ease;
      }
      .night .stars div:nth-child(n) {
        margin-left: 0;
        margin-top: 0;

        -webkit-transition: all 1s 0.4s ease-out;
        transition: all 1s 0.4s ease-out;
      }
      .stars div:nth-child(1) {
        left: 25%;
        top: 30%;
      }
      .stars div:nth-child(2) {
        left: 55%;
        top: 20%;
      }
      .stars div:nth-child(3) {
        left: 60%;
        top: 60%;
      }
      .stars div:nth-child(4) {
        left: 40%;
        top: 45%;
      }
      .stars div:nth-child(5) {
        left: 15%;
        top: 55%;
      }
      .stars div:nth-child(6) {
        left: 40%;
        top: 10%;
      }
      .stars div:nth-child(7) {
        left: 80%;
        top: 55%;
      }

      .water {
        position: absolute;
        background-image: radial-gradient(
            ellipse farthest-corner at center -400%,
            #f5c30e 30%,
            #518eac 90%
          );
        width: 100%;
        height: 200px;
        top: 68%;
      }
      .night .water {
        background-image: radial-gradient(
            ellipse farthest-corner at center -400%,
            #7fa1bb 30%,
            #1d425a 90%
          );
      }

      #outputTemp, #outputWindSpeed, #outputRainFall  {
        font-size: 190%;
      }
    </style>
  </head>
  <body onload="updateImage();">
    <script>
      //Stündliche aktualisierung der Daten
      $(document).ready(function() {
        setInterval(function() {
          reload_page();
          // alert("It worked");
        }, 60 * 60000); //1 Stunde
      });

      function reload_page() {
        window.location.reload(true);
      }

      //"http://www.zamg.ac.at/ogd/"
      $.ajax({
        type: "GET",
        url: "http://www.zamg.ac.at/ogd/",
        dataType: "text",
        success: function(csv) {
          //Einlesen der Variablen
          let index = 1;
          let tempIndex = 5;
          let windSpeedIndex = 9;
          let rainFallIndex = 12;

          //Teilt die einzelnen Lines in ein Array
          let lines = csv.split(/\r?\n|\r/);

          //macht aus der 1 Zeile (Wetter Hörsching) einen Array
          let currentline = lines[index].split(";");

          //Ausgabe der Elemente
          document.getElementById("outputTemp").innerHTML =
            currentline[tempIndex] + " °C";
          document.getElementById("outputWindSpeed").innerHTML =
            currentline[windSpeedIndex] + " km/h";
          document.getElementById("outputRainFall").innerHTML =
            currentline[rainFallIndex] + " m²";
        }
      });

      //Hintergrund je nach Zeit ändern
      function updateBackground() {
        //Aktuelle Stunde herausfinden
        var hr = new Date().getHours();
        var body = document.body;
        var bstyle = body.style;

        //Zwischen 19 und 21 Uhr bzw. 5 und 7 Uhr blauer Hintergrund
        if ((hr >= 19 && hr < 21) || (hr >= 5 && hr < 7)) {
          bstyle.backgroundColor = "#0059b3";
          bstyle.color = "black";
        //Zwischen 21 und 5 Uhr dunkelblauer Hintergrund 
        } else if (hr >= 21 || hr < 5) {
          bstyle.backgroundColor = "#000066";
          bstyle.color = "white";
        //Zwischen 7 und 19 Uhr hellblauer Hintergrund
        } else if (hr >= 7 && hr < 19) {
          bstyle.backgroundColor = "#ccefff";
          bstyle.color = "black";
          updateImage();
        //Sonst weißer Hintergrund
        } else {
          bstyle.backgroundColor = "white";
          bstyle.color = "black";
        }
      }
      //Jede Minute die Funktion updateBackground aufrufen
      setInterval(updateBackground, 1000 * 60);
      updateBackground();

      setInterval(updateImage, 1000 * 60);

      function updateImage() {
        var hr = new Date().getHours();
        var page = document.getElementById("fullpage");

        if(hr >= 21 || hr <= 5){
          page.classList.add("night");
        }else{
          page.classList.remove("night");
        }

      }
    </script>

    <div id="fullpage">
      <div class="section">
        <div class="time-circle">
          <p id="outputTemp"></p>
          <p id="outputWindSpeed"></p>
          <p id="outputRainFall"></p>
          <div class="sun"></div>
          <div class="moon">
            <div></div>
            <div></div>
            <div></div>
          </div>
          <div class="stars">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
          <div class="water"></div>
        </div>
      </div>
    </div>

  </body>
</html>
